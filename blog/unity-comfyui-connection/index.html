<!DOCTYPE html><html lang="en" data-astro-cid-37fxchfa> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/x-icon" href="favicon.png"><!-- Primary Meta Tags --><title>Bridging Unity and ComfyUI - Or How I Learned to Stop Worrying and Love HTTP Requests</title><meta name="title" content="Bridging Unity and ComfyUI - Or How I Learned to Stop Worrying and Love HTTP Requests"><meta name="description" content="Getting Unity to talk to ComfyUI for real-time 3D mesh generation from VR screenshots"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://astro-blog-template.netlify.app/blog/unity-comfyui-connection"><meta property="og:title" content="Bridging Unity and ComfyUI - Or How I Learned to Stop Worrying and Love HTTP Requests"><meta property="og:description" content="Getting Unity to talk to ComfyUI for real-time 3D mesh generation from VR screenshots"><meta property="og:image" content="https://astro-blog-template.netlify.app/assets/social.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://astro-blog-template.netlify.app/blog/unity-comfyui-connection"><meta property="twitter:title" content="Bridging Unity and ComfyUI - Or How I Learned to Stop Worrying and Love HTTP Requests"><meta property="twitter:description" content="Getting Unity to talk to ComfyUI for real-time 3D mesh generation from VR screenshots"><meta property="twitter:image" content="https://astro-blog-template.netlify.app/assets/social.png"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CMTcOisY.js"></script><!-- This is intentionally inlined to avoid FOUC --><script>
  const root = document.documentElement
  const theme = localStorage.getItem('theme')
  if (
    theme === 'dark' ||
    (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)
  ) {
    root.classList.add('theme-dark')
  } else {
    root.classList.remove('theme-dark')
  }
</script><style>div[data-astro-cid-2jiluk5e]{align-items:center;display:flex}img[data-astro-cid-2jiluk5e]{width:100px;height:100px;border-radius:100px;display:block;margin-right:20px}p[data-astro-cid-2jiluk5e]{font-size:1.125rem}header[data-astro-cid-4sn4zg3r]{text-align:center}header[data-astro-cid-4sn4zg3r] h1[data-astro-cid-4sn4zg3r]{margin-bottom:.7em}header[data-astro-cid-4sn4zg3r] p[data-astro-cid-4sn4zg3r]{color:var(--text-secondary);text-transform:uppercase;font-family:var(--font-family-sans);font-weight:600}header[data-astro-cid-4sn4zg3r] hr[data-astro-cid-4sn4zg3r]{min-width:100px;width:30%}
</style>
<link rel="stylesheet" href="/_astro/about.BqGDsome.css"></head> <body data-astro-cid-37fxchfa> <div class="layout" data-astro-cid-37fxchfa> <header data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-tvrurpns> <img alt="Blog Logo" src="/favicon.png" width="75" height="50" data-astro-cid-tvrurpns> </a> <nav data-astro-cid-dmqpwcec> <a class href="/" data-astro-cid-dmqpwcec>home</a> <!-- <a class={current === "about" ? "selected" : ""} href='/about'>about</a> --> <a class="selected" href="/blog" data-astro-cid-dmqpwcec>blog</a> <div class="theme-toggle-container" data-astro-cid-dmqpwcec> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1l6Je0" component-url="/_astro/ThemeToggleButton.B1Kp2Ltp.js" component-export="default" renderer-url="/_astro/client.svelte.xA49wdBm.js" props="{&quot;data-astro-cid-dmqpwcec&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ThemeToggleButton&quot;,&quot;value&quot;:true}" await-children><!--[--><div class="theme-toggle"><!--[--><label><!----><svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 20 20"
      fill="currentColor"
    >
      <path
        fill-rule="evenodd"
        d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
        clip-rule="evenodd"
      />
    </svg><!----> <input type="radio" name="theme-toggle" value="light" title="Use light theme" aria-label="Use light theme"></label><label><!----><svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 20 20"
      fill="currentColor"
    >
      <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
    </svg><!----> <input type="radio" name="theme-toggle" value="dark" title="Use dark theme" aria-label="Use dark theme"></label><!--]--></div><!--]--><!--astro:end--></astro-island> </div> </nav> </header> <main data-astro-cid-37fxchfa>  <header data-astro-cid-4sn4zg3r> <p data-astro-cid-4sn4zg3r>30 June 2025 ~ 4 min read</p> <h1 data-astro-cid-4sn4zg3r>Bridging Unity and ComfyUI - Or How I Learned to Stop Worrying and Love HTTP Requests</h1> <hr data-astro-cid-4sn4zg3r> </header> <div class="container" data-astro-cid-4sn4zg3r> <article class="content" data-astro-cid-4sn4zg3r> <h1 id="bridging-unity-and-comfyui---or-how-i-learned-to-stop-worrying-and-love-http-requests">Bridging Unity and ComfyUI - Or How I Learned to Stop Worrying and Love HTTP Requests</h1>
<p>Alright, so I had ComfyUI running locally with that Trellis workflow for image-to-mesh conversion. And I had Unity capturing screenshots from inside VR. But getting them to actually talk to each other? That turned into a bigger project than I expected.</p>
<h2 id="the-goal">The Goal</h2>
<p>The idea was simple: take a photo in VR, send it to ComfyUI, get a 3D mesh back, drop it into the scene. Real-time object scanning, basically. Sounds straightforward until you actually try to do it.</p>
<h2 id="comfyuis-api-sort-of">ComfyUI’s API (Sort Of)</h2>
<p>ComfyUI has an API, but it’s not exactly REST-friendly. It’s built around queuing workflows and checking status, not simple “send image, get mesh” requests. The workflow looks like this:</p>
<ol>
<li>POST your workflow JSON to <code>/prompt</code></li>
<li>Get back a prompt ID</li>
<li>Poll <code>/history/{prompt_id}</code> until it’s done</li>
<li>Download the output files</li>
</ol>
<p>Simple enough, except each step can fail in creative ways.</p>
<h2 id="unitys-http-client-the-painful-part">Unity’s HTTP Client (The Painful Part)</h2>
<p>Unity’s <code>UnityWebRequest</code> is… fine. But when you’re dealing with multipart uploads, JSON parsing, and file downloads, it gets messy fast. Here’s what I ended up building:</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#81A1C1">public</span><span style="color:#81A1C1"> class</span><span style="color:#8FBCBB"> ComfyUIClient</span><span style="color:#ECEFF4"> :</span><span style="color:#D8DEE9FF"> MonoBehaviour</span></span>
<span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#81A1C1">    private</span><span style="color:#81A1C1"> string</span><span style="color:#D8DEE9FF"> apiUrl </span><span style="color:#81A1C1">=</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">http://localhost:8188</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span></span>
<span class="line"><span style="color:#81A1C1">    public</span><span style="color:#81A1C1"> async</span><span style="color:#D8DEE9FF"> Task</span><span style="color:#ECEFF4">&#x3C;</span><span style="color:#81A1C1">string</span><span style="color:#ECEFF4">></span><span style="color:#88C0D0"> GenerateMesh</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">Texture2D image</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#ECEFF4">    {</span></span>
<span class="line"><span style="color:#616E88">        // Convert texture to byte array</span></span>
<span class="line"><span style="color:#81A1C1">        byte</span><span style="color:#ECEFF4">[]</span><span style="color:#D8DEE9FF"> imageData </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9"> image</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">EncodeToPNG</span><span style="color:#ECEFF4">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span></span>
<span class="line"><span style="color:#616E88">        // Upload image first</span></span>
<span class="line"><span style="color:#81A1C1">        string</span><span style="color:#D8DEE9FF"> imageId </span><span style="color:#81A1C1">=</span><span style="color:#81A1C1"> await</span><span style="color:#88C0D0"> UploadImage</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">imageData</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span></span>
<span class="line"><span style="color:#616E88">        // Queue the workflow</span></span>
<span class="line"><span style="color:#81A1C1">        string</span><span style="color:#D8DEE9FF"> promptId </span><span style="color:#81A1C1">=</span><span style="color:#81A1C1"> await</span><span style="color:#88C0D0"> QueueWorkflow</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">imageId</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span></span>
<span class="line"><span style="color:#616E88">        // Wait for completion</span></span>
<span class="line"><span style="color:#81A1C1">        await</span><span style="color:#88C0D0"> WaitForCompletion</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">promptId</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span></span>
<span class="line"><span style="color:#616E88">        // Download the mesh</span></span>
<span class="line"><span style="color:#81A1C1">        return</span><span style="color:#81A1C1"> await</span><span style="color:#88C0D0"> DownloadMesh</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">promptId</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">    }</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span></code></pre>
<p>The devil is in the implementation of those methods. <code>UploadImage</code> needs to handle multipart form data. <code>QueueWorkflow</code> requires building the workflow JSON dynamically with the uploaded image ID. <code>WaitForCompletion</code> is basically polling hell.</p>
<h2 id="the-workflow-json-nightmare">The Workflow JSON Nightmare</h2>
<p>ComfyUI workflows are these massive JSON structures that define every node and connection. To make this work dynamically, I had to:</p>
<ol>
<li>Export my working Trellis workflow as JSON</li>
<li>Find the image input node ID</li>
<li>Replace the image filename with the uploaded image ID at runtime</li>
</ol>
<p>This meant parsing and rebuilding JSON in Unity, which is always fun with C#‘s type system.</p>
<h2 id="file-transfer-headaches">File Transfer Headaches</h2>
<p>The biggest pain was actually getting files back and forth. ComfyUI expects images in its input folder, but the API upload puts them somewhere else. The output files have generated names that you have to parse from the history response.</p>
<p>I ended up writing a custom file transfer system that:</p>
<ul>
<li>Uploads images with predictable names</li>
<li>Maps ComfyUI’s internal file IDs to actual filenames</li>
<li>Downloads .obj files and converts them to Unity meshes</li>
</ul>
<h2 id="making-it-work-in-vr">Making It Work in VR</h2>
<p>All this HTTP request dance needed to happen without freezing the VR experience. So everything had to be async:</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#81A1C1">public</span><span style="color:#81A1C1"> async</span><span style="color:#81A1C1"> void</span><span style="color:#88C0D0"> OnCameraCapture</span><span style="color:#ECEFF4">()</span></span>
<span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#616E88">    // Capture screenshot</span></span>
<span class="line"><span style="color:#D8DEE9FF">    Texture2D screenshot </span><span style="color:#81A1C1">=</span><span style="color:#88C0D0"> CaptureVRView</span><span style="color:#ECEFF4">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span></span>
<span class="line"><span style="color:#616E88">    // Show loading indicator</span></span>
<span class="line"><span style="color:#88C0D0">    ShowLoadingUI</span><span style="color:#ECEFF4">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span></span>
<span class="line"><span style="color:#81A1C1">    try</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">    {</span></span>
<span class="line"><span style="color:#616E88">        // Send to ComfyUI (this takes 10-30 seconds)</span></span>
<span class="line"><span style="color:#81A1C1">        string</span><span style="color:#D8DEE9FF"> meshPath </span><span style="color:#81A1C1">=</span><span style="color:#81A1C1"> await</span><span style="color:#D8DEE9"> comfyClient</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">GenerateMesh</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">screenshot</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span></span>
<span class="line"><span style="color:#616E88">        // Load into Unity</span></span>
<span class="line"><span style="color:#D8DEE9FF">        GameObject mesh </span><span style="color:#81A1C1">=</span><span style="color:#88C0D0"> LoadMeshFromFile</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">meshPath</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span></span>
<span class="line"><span style="color:#616E88">        // Spawn in VR scene</span></span>
<span class="line"><span style="color:#88C0D0">        SpawnMeshInVR</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">mesh</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">    }</span></span>
<span class="line"><span style="color:#81A1C1">    finally</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">    {</span></span>
<span class="line"><span style="color:#88C0D0">        HideLoadingUI</span><span style="color:#ECEFF4">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">    }</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span></code></pre>
<p>The tricky part is keeping the user engaged during that 10-30 second processing time. I added a spinning loading indicator and some feedback text, but it’s still a long wait.</p>
<h2 id="what-actually-works">What Actually Works</h2>
<p>After about a week of debugging HTTP requests and JSON parsing, I have a system that:</p>
<ul>
<li>Takes a VR screenshot</li>
<li>Sends it to ComfyUI running locally</li>
<li>Generates a basic 3D mesh</li>
<li>Imports it back into Unity</li>
<li>Spawns it in the VR scene</li>
</ul>
<p>It’s not fast, and the mesh quality is hit-or-miss, but it works. Seeing an object you just photographed appear as a 3D model in VR is pretty magical, even when it looks like it was made of clay.</p>
<h2 id="the-real-lesson">The Real Lesson</h2>
<p>Most of the work here wasn’t the fancy AI stuff - it was just getting two different systems to exchange files reliably. Unity wants Texture2D objects, ComfyUI wants PNG files in specific folders, everybody has different ideas about how async operations should work.</p>
<p>Sometimes the most “AI-powered” part of your project is just a really complicated file upload script.</p> </article> <hr data-astro-cid-4sn4zg3r> <div data-astro-cid-2jiluk5e> <img src="/assets/HEADSHOT.jpg" alt="Headshot of Maxi Ferreira" data-astro-cid-2jiluk5e> <p data-astro-cid-2jiluk5e>
Hi, I'm <strong data-astro-cid-2jiluk5e>Frederik</strong>. I'm a devine student based in Belgium.
    You can 
    see some of my work on <a href="https://github.com/FrederikDG" target="_blank" data-astro-cid-2jiluk5e>GitHub</a>,
    or read more about me on <a href="https://www.studiolost.be" target="_blank" data-astro-cid-2jiluk5e>my website</a>.
</p> </div>  </div>  </main> <footer data-astro-cid-sz7xmlte> <span data-astro-cid-sz7xmlte>
&copy; 2025 Jan-Frederik de Graaf
</span> </footer>  </div> </body></html> 